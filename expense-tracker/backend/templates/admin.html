<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Qu·∫£n l√Ω Chi ph√≠</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 10px; }
        .container { max-width: 1200px; margin: 0 auto; background: white; border-radius: 20px; padding: 25px; box-shadow: 0 10px 40px rgba(0,0,0,0.15); }
        
        /* Header */
        .header { text-align: center; margin-bottom: 30px; }
        .header h1 { color: #2c3e50; font-size: 2rem; font-weight: 800; margin-bottom: 10px; }
        .header p { color: #7f8c8d; font-size: 1rem; }
        
        /* Stats Cards */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: linear-gradient(135deg, #3498db, #2980b9); color: white; padding: 25px; border-radius: 15px; text-align: center; box-shadow: 0 5px 20px rgba(52,152,219,0.3); }
        .stat-card.summary { background: linear-gradient(135deg, #27ae60, #229954); box-shadow: 0 5px 20px rgba(39,174,96,0.3); }
        .stat-card h3 { font-size: 1.1rem; margin-bottom: 10px; opacity: 0.9; }
        .stat-card .number { font-size: 2.5rem; font-weight: 800; margin-bottom: 5px; }
        .stat-card .label { font-size: 0.9rem; opacity: 0.8; }
        
        /* Summary Details */
        .summary-details { background: #f8f9fa; border-radius: 15px; padding: 20px; margin-bottom: 30px; }
        .summary-details h3 { color: #2c3e50; margin-bottom: 15px; font-size: 1.2rem; }
        .summary-item { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #e9ecef; }
        .summary-item:last-child { border-bottom: none; font-weight: 700; background: #e8f5e8; margin: 10px -20px -20px; padding: 15px 20px; border-radius: 0 0 15px 15px; }
        .person-name { font-weight: 600; color: #2c3e50; }
        .person-amount { font-weight: 700; color: #e74c3c; }
        
        /* Action Buttons */
        .actions { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px; }
        .btn { padding: 15px 20px; border: none; border-radius: 12px; font-weight: 600; font-size: 1rem; cursor: pointer; transition: all 0.3s ease; text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-primary { background: linear-gradient(135deg, #3498db, #2980b9); color: white; box-shadow: 0 4px 15px rgba(52,152,219,0.3); }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(52,152,219,0.4); }
        .btn-warning { background: linear-gradient(135deg, #f39c12, #e67e22); color: white; box-shadow: 0 4px 15px rgba(243,156,18,0.3); }
        .btn-warning:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(243,156,18,0.4); }
        .btn-danger { background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; box-shadow: 0 4px 15px rgba(231,76,60,0.3); }
        .btn-danger:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(231,76,60,0.4); }
        
        /* Expense Cards */
        .expenses-grid { display: grid; gap: 15px; }
        .expense-card { background: white; border-radius: 12px; padding: 15px; box-shadow: 0 3px 12px rgba(0,0,0,0.08); border-left: 4px solid #3498db; transition: all 0.3s ease; cursor: pointer; }
        .expense-card:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,0,0,0.12); }
        .expense-card.expanded { border-left-color: #e74c3c; }
        
        .card-summary { display: flex; justify-content: space-between; align-items: center; }
        .summary-left { flex: 1; }
        .summary-right { display: flex; align-items: center; gap: 15px; }
        
        .card-items-summary { font-size: 1.1rem; font-weight: 600; color: #2c3e50; margin-bottom: 5px; }
        .card-quantity-summary { color: #8e44ad; font-weight: 500; font-size: 0.9rem; }
        .card-amount { font-size: 1.6rem; font-weight: 800; color: #e74c3c; }
        .expand-icon { font-size: 1.2rem; color: #7f8c8d; transition: transform 0.3s ease; }
        .expense-card.expanded .expand-icon { transform: rotate(180deg); }
        
        .card-details { display: none; margin-top: 15px; padding-top: 15px; border-top: 1px solid #ecf0f1; }
        .expense-card.expanded .card-details { display: block; animation: slideDown 0.3s ease; }
        
        .detail-row { display: flex; justify-content: space-between; margin-bottom: 8px; }
        .detail-label { color: #7f8c8d; font-weight: 500; }
        .detail-value { color: #2c3e50; font-weight: 600; }
        
        .card-actions { display: flex; gap: 10px; margin-top: 15px; }
        .btn-sm { padding: 8px 16px; font-size: 0.9rem; border-radius: 8px; }
        
        /* Delete Confirmation */
        .delete-confirm { display: none; background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px; padding: 15px; margin-top: 10px; }
        .delete-confirm.show { display: block; animation: slideDown 0.3s ease; }
        .delete-confirm p { margin-bottom: 10px; color: #856404; }
        .delete-confirm .actions { display: flex; gap: 10px; margin: 0; }
        .delete-confirm .btn { padding: 8px 16px; font-size: 0.9rem; }
        
        /* Empty State */
        .empty-state { text-align: center; padding: 60px 20px; color: #7f8c8d; }
        .empty-state .icon { font-size: 4rem; margin-bottom: 20px; }
        .empty-state h3 { font-size: 1.5rem; margin-bottom: 10px; }
        .empty-state p { font-size: 1rem; }
        
        /* Responsive */
        @media (max-width: 768px) {
            body { padding: 5px; }
            .container { padding: 15px; border-radius: 15px; }
            .header h1 { font-size: 1.5rem; }
            .stat-card .number { font-size: 2rem; }
            .stats-grid { grid-template-columns: 1fr; }
            .actions { grid-template-columns: 1fr; }
            .card-header { flex-direction: column; align-items: flex-start; }
            .card-amount { font-size: 1.5rem; }
        }
        
        @media (max-width: 480px) {
            .container { padding: 10px; }
            .header h1 { font-size: 1.3rem; }
            .stat-card { padding: 20px 15px; }
            .expense-card { padding: 15px; }
        }
        
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üíº Admin Dashboard</h1>
            <p>Qu·∫£n l√Ω chi ph√≠ v√† giao d·ªãch</p>
        </div>
        
        <!-- Stats Cards -->
        <div class="stats-grid">
            <div class="stat-card">
                <h3>T·ªïng giao d·ªãch</h3>
                <div class="number">{{.total}}</div>
                <div class="label">giao d·ªãch</div>
            </div>
            <div class="stat-card summary">
                <h3>T·ªïng chi ph√≠</h3>
                <div class="number">{{.grandTotal}}</div>
                <div class="label">VND</div>
            </div>
        </div>
        
        <!-- Summary Details -->
        {{if .summary}}
        <div class="summary-details">
            <h3>üìä Chi ti·∫øt theo ng∆∞·ªùi</h3>
            {{range $person, $total := .summary}}
            <div class="summary-item">
                <span class="person-name">üë§ {{$person}}</span>
                <span class="person-amount">{{printf "%d" $total}} VND</span>
            </div>
            {{end}}
            <div class="summary-item">
                <span class="person-name">üí∞ T·ªîNG C·ªòNG</span>
                <span class="person-amount">{{printf "%d" .grandTotal}} VND</span>
            </div>
        </div>
        {{end}}
        
        <!-- Action Buttons -->
        <div class="actions">
            <button class="btn btn-primary" onclick="location.reload()">
                üîÑ L√†m m·ªõi
            </button>
            <a href="/admin/deleted" class="btn btn-warning">
                üóëÔ∏è Xem ƒë√£ x√≥a
            </a>
            <a href="/admin/export-csv" class="btn btn-primary">
                üì• T·∫£i CSV
            </a>
        </div>
        
        <!-- Expenses Grid -->
        <div class="expenses-grid">
            {{range $index, $expense := .expenses}}
            <div class="expense-card" onclick="toggleExpand({{$index}})">
                <!-- Summary View -->
                <div class="card-summary">
                    <div class="summary-left">
                        <div class="card-items-summary">{{$expense.items}}</div>
                        {{if or $expense.quantity $expense.unit}}
                        <div class="card-quantity-summary">üì¶ {{$expense.quantity}} {{$expense.unit}}</div>
                        {{end}}
                    </div>
                    <div class="summary-right">
                        <div class="card-amount">{{printf "%d" $expense.amount}} VND</div>
                        <div class="expand-icon">‚ñº</div>
                    </div>
                </div>
                
                <!-- Detailed View -->
                <div class="card-details" id="details-{{$index}}">
                    <div class="detail-row">
                        <span class="detail-label">üìÖ Ng√†y:</span>
                        <span class="detail-value">{{$expense.paidDate}}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">üë§ Ng∆∞·ªùi tr·∫£:</span>
                        <span class="detail-value">{{$expense.paidBy}}</span>
                    </div>
                    {{if or $expense.quantity $expense.unit}}
                    <div class="detail-row">
                        <span class="detail-label">üì¶ S·ªë l∆∞·ª£ng:</span>
                        <span class="detail-value">{{$expense.quantity}}{{if $expense.unit}} {{$expense.unit}}{{end}}</span>
                    </div>
                    {{end}}
                    
                    <div class="card-actions" onclick="event.stopPropagation()">
                        <button class="btn btn-danger btn-sm" onclick="showDeleteConfirm('{{$expense.id}}', {{$index}})">
                            üóëÔ∏è X√≥a
                        </button>
                    </div>
                    
                    <!-- Delete Confirmation -->
                    <div id="deleteConfirm-{{$index}}" class="delete-confirm">
                        <p><strong>X√°c nh·∫≠n x√≥a:</strong> "{{$expense.items}}" - {{printf "%d" $expense.amount}} VND?</p>
                        <div class="actions">
                            <button class="btn btn-danger" onclick="deleteExpense('{{$expense.id}}', {{$index}})">X√≥a</button>
                            <button class="btn btn-primary" onclick="hideDeleteConfirm({{$index}})">H·ªßy</button>
                        </div>
                    </div>
                </div>
            </div>
            {{else}}
            <div class="empty-state">
                <div class="icon">üìä</div>
                <h3>Ch∆∞a c√≥ d·ªØ li·ªáu</h3>
                <p>H√£y th√™m chi ph√≠ ƒë·∫ßu ti√™n c·ªßa b·∫°n</p>
            </div>
            {{end}}
        </div>
    </div>
    
    <script>
        // Toggle expand/collapse
        function toggleExpand(index) {
            const card = document.querySelectorAll('.expense-card')[index];
            card.classList.toggle('expanded');
        }
        
        // Format numbers with comma separator
        function formatMoney(amount) {
            return new Intl.NumberFormat('vi-VN').format(amount);
        }
        
        // Format all amounts on page load
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.card-amount, .person-amount').forEach(function(el) {
                const text = el.textContent;
                const amount = parseInt(text.replace(' VND', ''));
                if (!isNaN(amount)) {
                    el.textContent = formatMoney(amount) + ' VND';
                }
            });
            
            // Format stat card numbers
            document.querySelectorAll('.stat-card .number').forEach(function(el) {
                const amount = parseInt(el.textContent);
                if (!isNaN(amount) && amount > 0) {
                    el.textContent = formatMoney(amount);
                }
            });
        });
        
        // Show delete confirmation
        function showDeleteConfirm(id, index) {
            const confirm = document.getElementById('deleteConfirm-' + index);
            confirm.classList.add('show');
        }
        
        // Hide delete confirmation
        function hideDeleteConfirm(index) {
            const confirm = document.getElementById('deleteConfirm-' + index);
            confirm.classList.remove('show');
        }
        
        // Delete expense
        function deleteExpense(id, index) {
            fetch('/admin/expense/' + id, {
                method: 'DELETE'
            })
            .then(response => response.json())
            .then(data => {
                if (data.message) {
                    location.reload();
                } else {
                    alert('L·ªói: ' + data.error);
                }
            })
            .catch(error => {
                alert('L·ªói: ' + error);
            });
        }
    </script>
</body>
</html>